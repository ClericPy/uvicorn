



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="The lightning-fast ASGI server.">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Server Behavior - Uvicorn</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#server-behavior" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Uvicorn" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Uvicorn
            </span>
            <span class="md-header-nav__topic">
              
                Server Behavior
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/encode/uvicorn" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    encode/uvicorn
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Uvicorn" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Uvicorn
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/encode/uvicorn" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    encode/uvicorn
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../settings/" title="Settings" class="md-nav__link">
      Settings
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../deployment/" title="Deployment" class="md-nav__link">
      Deployment
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Server Behavior
      </label>
    
    <a href="./" title="Server Behavior" class="md-nav__link md-nav__link--active">
      Server Behavior
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#http-headers" class="md-nav__link">
    HTTP Headers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flow-control" class="md-nav__link">
    Flow Control
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#write-flow-control" class="md-nav__link">
    Write flow control
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-flow-control" class="md-nav__link">
    Read flow control
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#request-and-response-bodies" class="md-nav__link">
    Request and Response bodies
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#response-completion" class="md-nav__link">
    Response completion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expect-100-continue" class="md-nav__link">
    Expect: 100-Continue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#head-requests" class="md-nav__link">
    HEAD requests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timeouts" class="md-nav__link">
    Timeouts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-limits" class="md-nav__link">
    Resource Limits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-errors" class="md-nav__link">
    Server Errors
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exceptions" class="md-nav__link">
    Exceptions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invalid-responses" class="md-nav__link">
    Invalid responses
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#graceful-process-shutdown" class="md-nav__link">
    Graceful Process Shutdown
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-pipelining" class="md-nav__link">
    HTTP Pipelining
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#http-headers" class="md-nav__link">
    HTTP Headers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flow-control" class="md-nav__link">
    Flow Control
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#write-flow-control" class="md-nav__link">
    Write flow control
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-flow-control" class="md-nav__link">
    Read flow control
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#request-and-response-bodies" class="md-nav__link">
    Request and Response bodies
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#response-completion" class="md-nav__link">
    Response completion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expect-100-continue" class="md-nav__link">
    Expect: 100-Continue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#head-requests" class="md-nav__link">
    HEAD requests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timeouts" class="md-nav__link">
    Timeouts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-limits" class="md-nav__link">
    Resource Limits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-errors" class="md-nav__link">
    Server Errors
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exceptions" class="md-nav__link">
    Exceptions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invalid-responses" class="md-nav__link">
    Invalid responses
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#graceful-process-shutdown" class="md-nav__link">
    Graceful Process Shutdown
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-pipelining" class="md-nav__link">
    HTTP Pipelining
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="server-behavior">Server Behavior</h1>
<p>Uvicorn is designed with particular attention to connection and resource management, in order to provide a robust server implementation. It aims to ensure graceful behavior to either server or client errors, and resilience to poor client behavior or denial of service attacks.</p>
<h2 id="http-headers">HTTP Headers</h2>
<p>The <code>Server</code> and <code>Date</code> headers are added to all outgoing requests.</p>
<p>If a <code>Connection: Close</code> header is included then Uvicorn will close the connection after the response. Otherwise connections will stay open, pending the keep-alive timeout.</p>
<p>If a <code>Content-Length</code> header is included then Uvicorn will ensure that the content length of the response body matches the value in the header, and raise an error otherwise.</p>
<p>If no <code>Content-Length</code> header is included then Uvicorn will use chunked encoding for the response body, and will set a <code>Transfer-Encoding</code> header if required.</p>
<p>If a <code>Transfer-Encoding</code> header is included then any <code>Content-Length</code> header will be ignored.</p>
<p>HTTP headers are mandated to be case-insensitive. Uvicorn will always send response headers strictly in lowercase.</p>
<hr />
<h2 id="flow-control">Flow Control</h2>
<p>Proper flow control ensures that large amounts of data does not become buffered on the transport when either side of a connection is sending data faster than its counterpart is able to handle.</p>
<h3 id="write-flow-control">Write flow control</h3>
<p>If the write buffer passes a high water mark, then Uvicorn ensures the ASGI <code>send</code> messages will only return once the write buffer has been drained below the low water mark.</p>
<h3 id="read-flow-control">Read flow control</h3>
<p>Uvicorn will pause reading from a transport once the buffered request body hits a high water mark, and will only resume once <code>receive</code> has been called, or once the response has been sent.</p>
<hr />
<h2 id="request-and-response-bodies">Request and Response bodies</h2>
<h3 id="response-completion">Response completion</h3>
<p>Once a response has been sent, Uvicorn will no longer buffer any remaining request body. Any later calls to <code>receive</code> will return an <code>http.disconnect</code> message.</p>
<p>Together with the read flow control, this behavior ensures that responses that return without reading the request body will not stream any substantial amounts of data into memory.</p>
<h3 id="expect-100-continue">Expect: 100-Continue</h3>
<p>The <code>Expect: 100-Continue</code> header may be sent by clients to require a confirmation from the server before uploading the request body. This can be used to ensure that large request bodies are only sent once the client has confirmation that the server is willing to accept the request.</p>
<p>Uvicorn ensures that any required <code>100 Continue</code> confirmations are only sent if the ASGI application calls <code>receive</code> to read the request body.</p>
<p>Note that that proxy configurations may not necessarily forward on <code>Expect: 100-Continue</code> headers. In particular Nginx defaults to buffering request bodies, and automatically sends <code>100 Continues</code> rather than passing the header on to the upstream server.</p>
<h3 id="head-requests">HEAD requests</h3>
<p>Uvicorn will strip any response body from HTTP requests with the <code>HEAD</code> method.</p>
<p>Applications should generally treat <code>HEAD</code> requests in the same manner as <code>GET</code> requests, in order to ensure that identical headers are sent in both cases, and that any ASGI middleware that modifies the headers will operate identically in either case.</p>
<p>One exception to this might be if your application serves large file downloads, in which case you might wish to only generate the response headers.</p>
<hr />
<h2 id="timeouts">Timeouts</h2>
<p>Uvicorn provides the following timeouts:</p>
<ul>
<li>Keep-Alive. Defaults to 5 seconds. Between requests, connections must receive new data within this period or be disconnected.</li>
</ul>
<hr />
<h2 id="resource-limits">Resource Limits</h2>
<p>Uvicorn provides the following resource limiting:</p>
<ul>
<li>Concurrency. Defaults to <code>None</code>. If set, this provides a maximum number of concurrent tasks <em>or</em> open connections that should be allowed. Any new requests or connections that occur once this limit has been reached will result in a "503 Service Unavailable" response. Setting this value to a limit that you know your servers are able to support will help ensure reliable resource usage, even against significantly over-resourced servers.</li>
<li>Max requests. Defaults to <code>None</code>. If set, this provides a maximum number of HTTP requests that will be serviced before terminating a process. Together with a process manager this can be used to prevent memory leaks from impacting long running processes.</li>
</ul>
<hr />
<h2 id="server-errors">Server Errors</h2>
<p>Server errors will be logged at the <code>error</code> log level. All logging defaults to being written to <code>stdout</code>.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If an exception is raised by an ASGI application, and a response has not yet been sent on the connection, then a <code>500 Server Error</code> HTTP response will be sent.</p>
<h3 id="invalid-responses">Invalid responses</h3>
<p>Uvicorn will ensure that ASGI applications send the correct sequence of messages, and will raise errors otherwise. This includes checking for no response sent, partial response sent, or invalid message sequences being sent.</p>
<hr />
<h2 id="graceful-process-shutdown">Graceful Process Shutdown</h2>
<p>Graceful process shutdowns are particularly important during a restart period. During this period you want to:</p>
<ul>
<li>Start a number of new server processes to handle incoming requests, listening on the existing socket.</li>
<li>Stop the previous server processes from listening on the existing socket.</li>
<li>Close any connections that are not currently waiting on an HTTP response, and wait for any other connections to finalize their HTTP responses.</li>
<li>Wait for any background tasks to run to completion, such as occurs when the ASGI application has sent the HTTP response, but the asyncio task has not yet run to completion.</li>
</ul>
<p>Uvicorn handles process shutdown gracefully, ensuring that connections are properly finalized, and all tasks have run to completion. During a shutdown period Uvicorn will ensure that responses and tasks must still complete within the configured timeout periods.</p>
<hr />
<h2 id="http-pipelining">HTTP Pipelining</h2>
<p>HTTP/1.1 provides support for sending multiple requests on a single connection, before having received each corresponding response. Servers are required to support HTTP pipelining, but it is now generally accepted to lead to implementation issues. It is not enabled on browsers, and may not necessarily be enabled on any proxies that the HTTP request passes through.</p>
<p>Uvicorn supports pipelining pragmatically. It will queue up any pipelined HTTP requests, and pause reading from the underlying transport. It will not start processing pipelined requests until each response has been dealt with in turn.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../deployment/" title="Deployment" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Deployment
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="../js/chat.js"></script>
      
        <script src="../js/sidecar-1.5.0.js"></script>
      
    
  </body>
</html>